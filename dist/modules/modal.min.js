/**
 * angular-strap
 * @version v2.0.3 - 2014-07-08
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("mgcrea.ngStrap.modal",["mgcrea.ngStrap.helpers.dimensions"]).provider("$modal",function(){var e=this.defaults={prefixClass:"modal",prefixEvent:"modal",placement:"top",template:"modal/modal.tpl.html",contentTemplate:!1,container:!1,element:null,keyboard:!1,html:!1,show:!0};this.$get=["$window","$rootScope","$compile","$q","$templateCache","$http","$timeout","$sce",function(t,n,o,i,r,a,l,c){function s(t){var i={},r=i.$options=angular.extend({},e,t);i.$promise=$(r.template);var a=i.$scope=r.scope&&r.scope.$new()||n.$new();r.element||r.container||(r.container="body"),p(["title","content"],function(e){r[e]&&(a[e]=c.trustAsHtml(r[e]))}),a.$hide=function(){a.$$postDigest(function(){i.hide()})},a.$show=function(){a.$$postDigest(function(){i.show()})},a.$toggle=function(){a.$$postDigest(function(){i.toggle()})},r.contentTemplate&&(i.$promise=i.$promise.then(function(e){var n=angular.element(e);return $(r.contentTemplate).then(function(e){var o=u('[ng-bind="content"]',n[0]).removeAttr("ng-bind").html(e);return t.template||o.next().remove(),n[0].outerHTML})}));var l,s;return i.$promise.then(function(e){angular.isObject(e)&&(e=e.data),r.html&&(e=e.replace(f,'ng-bind-html="')),e=m.apply(e),l=o(e),i.init()}),i.init=function(){r.show&&a.$$postDigest(function(){i.show()}),s=i.$element=l(a,function(){});var e=r.container?u(r.container):null;e.append(s)},i.destroy=function(){s&&(s.remove(),s=null),a.$destroy()},i.show=function(){a.$emit(r.prefixEvent+".show.before",i),s.css({display:"block"}).addClass(r.placement),a.$isShown=!0,a.$$phase||a.$root&&a.$root.$$phase||a.$digest();var e=s[0];d(function(){e.focus()});var t=r.container?u(r.container):null;t&&t.addClass("is-visible"),r.keyboard&&s.on("keyup",i.$onKeyUp)},i.hide=function(){a.$emit(r.prefixEvent+".hide.before",i),a.$emit(r.prefixEvent+".hide",i);var e=r.container?u(r.container):null;e&&e.removeClass("is-visible"),a.$isShown=!1,a.$$phase||a.$root&&a.$root.$$phase||a.$digest(),r.keyboard&&s.off("keyup",i.$onKeyUp)},i.toggle=function(){a.$isShown?i.hide():i.show()},i.focus=function(){s[0].focus()},i.$onKeyUp=function(e){27===e.which&&i.hide()},i}function u(e,t){return angular.element((t||document).querySelectorAll(e))}function $(e){return i.when(r.get(e)||a.get(e)).then(function(t){return angular.isObject(t)?(r.put(e,t.data),t.data):t})}var p=angular.forEach,m=String.prototype.trim,d=t.requestAnimationFrame||t.setTimeout,f=(angular.element(t.document.body),/ng-bind="/gi);return s}]}).directive("bsModal",["$window","$location","$sce","$modal",function(e,t,n,o){return{restrict:"EAC",scope:!0,link:function(e,t,i){var r={scope:e,element:t,show:!1};angular.forEach(["template","contentTemplate","placement","backdrop","keyboard","html","container"],function(e){angular.isDefined(i[e])&&(r[e]=i[e])}),angular.forEach(["title","content"],function(t){i[t]&&i.$observe(t,function(o){e[t]=n.trustAsHtml(o)})}),i.bsModal&&e.$watch(i.bsModal,function(t){angular.isObject(t)?angular.extend(e,t):e.content=t},!0);var a=o(r);t.on(i.trigger||"click",a.toggle),e.$on("$destroy",function(){a.destroy(),r=null,a=null})}}}]);